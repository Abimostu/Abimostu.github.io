---
title: "定时任务"
date: 2022-10-23T10:42:30+08:00
draft: false
---

本文介绍java开发过程中如何实现定时任务。实现方式主要包括两种：一种是依赖spring的定时任务抽象；另一种使用Quartz实现。

## 1. 方案对比

|                   | 优点                                       | 缺点                                                 |
| ----------------- | ------------------------------------------ | ---------------------------------------------------- |
| Spring Scheduling | 实现简单，spring项目直接集成               | 灵活性不足，开关定时任务等不便                       |
| Quartz            | 功能强大，支持集群以及所有定时任务相关功能 | 实现相对复杂，需要引入组件；集群需要数据库进行持久化 |

## 2. Spring Scheduling

### 2.1. TaskScheduler Abstraction

使用TaskScheduler 接口，其中最简单的就是schedule方法可以在未来的某一时间点执行task，这也是对于简单的5分钟后执行某操作一类需求的推荐方式。

```java 
public interface TaskScheduler {

    ScheduledFuture schedule(Runnable task, Trigger trigger);

    ScheduledFuture schedule(Runnable task, Instant startTime);

    ScheduledFuture schedule(Runnable task, Date startTime);

    ScheduledFuture scheduleAtFixedRate(Runnable task, Instant startTime, Duration period);

    ScheduledFuture scheduleAtFixedRate(Runnable task, Date startTime, long period);

    ScheduledFuture scheduleAtFixedRate(Runnable task, Duration period);

    ScheduledFuture scheduleAtFixedRate(Runnable task, long period);

    ScheduledFuture scheduleWithFixedDelay(Runnable task, Instant startTime, Duration delay);

    ScheduledFuture scheduleWithFixedDelay(Runnable task, Date startTime, long delay);

    ScheduledFuture scheduleWithFixedDelay(Runnable task, Duration delay);

    ScheduledFuture scheduleWithFixedDelay(Runnable task, long delay);
}
```

### 2.2. 实现方法

**spring boot配置项**

- spring.task.scheduling.thread-name-prefix=scheduling-
- spring.task.scheduling.pool.size=8
  spring会根据配置项生成ThreadPoolTaskScheduler Bean，只需构建task并调用TaskScheduler接口即可

---

## 3. Quartz

### 3.1. 文档

* [Spring Boot Quartz](https://docs.spring.io/spring-boot/docs/2.7.3/reference/htmlsingle/#io.quartz)

* [Quartz Scheduler](https://www.quartz-scheduler.org/)

### 3.2. Spring Boot 配置 Quartz为集群模式

> spring.quartz.job-store-type=jdbc
> spring.quartz.properties.org.quartz.scheduler.instanceName=RrMgm_Scheduler
> spring.quartz.properties.org.quartz.scheduler.instanceId=AUTO
> spring.quartz.properties.org.quartz.jobStore.isClustered=true